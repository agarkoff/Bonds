<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–æ–ø –æ–±–ª–∏–≥–∞—Ü–∏–π –ø–æ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.2em;
            font-weight: 300;
        }
        
        .info {
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .table-container {
            overflow-x: auto;
            padding: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        th {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            border: 1px solid #dee2e6;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        td {
            padding: 10px 8px;
            text-align: center;
            border: 1px solid #dee2e6;
            white-space: nowrap;
        }
        
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        tr:hover {
            background-color: #e3f2fd;
        }
        
        .ticker {
            font-weight: bold;
            color: #1976d2;
            min-width: 80px;
        }
        
        .short-name {
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            text-align: left;
            padding-left: 12px;
        }
        
        .rating {
            font-weight: bold;
            text-align: center;
            min-width: 60px;
            font-size: 11px;
            border-radius: 4px;
            padding: 4px 6px !important;
        }
        
        .rating[title*="–Ω–µ –ø—Ä–∏—Å–≤–æ–µ–Ω"] {
            color: #999;
            font-style: italic;
        }
        
        .group-header {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            font-weight: bold;
            color: #1565c0;
        }
        
        .costs-group { border-left: 4px solid #ff9800; }
        .income-group { border-left: 4px solid #4caf50; }
        .results-group { border-left: 4px solid #9c27b0; }
        
        .currency::after {
            content: " ‚ÇΩ";
            color: #666;
        }
        
        .percentage::after {
            content: "%";
            color: #666;
        }
        
        .yield-cell {
            font-weight: bold;
            border-radius: 4px;
            padding: 8px !important;
        }
        
        .controls {
            padding: 15px 20px;
            background: #f8f9fa;
            border-top: 1px solid #dee2e6;
        }
        
        .form-group {
            display: inline-block;
            margin-right: 20px;
        }
        
        label {
            font-weight: 600;
            margin-right: 10px;
        }
        
        input, button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        input[type="number"] {
            width: 120px;
        }
        
        input::placeholder {
            color: #999;
            font-style: italic;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }
        
        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .date {
            color: #666;
            font-size: 11px;
        }
        
        .legend {
            padding: 15px 20px;
            background: #f8f9fa;
            border-top: 1px solid #dee2e6;
            font-size: 12px;
            text-align: center;
        }
        
        .legend-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 13px;
        }
        
        .legend-items {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 20px;
            height: 15px;
            border-radius: 3px;
            display: inline-block;
        }
        
        .legend-text {
            font-size: 11px;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÜ –¢–æ–ø –æ–±–ª–∏–≥–∞—Ü–∏–π –ø–æ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏</h1>
        </div>
        
        <div class="info">
            <div>
                <strong>–ü–æ–∫–∞–∑–∞–Ω–æ:</strong> <span th:text="${totalBonds}">0</span> –æ–±–ª–∏–≥–∞—Ü–∏–π
            </div>
            <div>
                <strong>–û–±–Ω–æ–≤–ª–µ–Ω–æ:</strong> <span th:text="${#temporals.format(#temporals.createNow(), 'dd.MM.yyyy HH:mm')}"></span>
            </div>
        </div>
        
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th rowspan="2">–¢–∏–∫–µ—Ä</th>
                        <th rowspan="2">–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th rowspan="2">–†–µ–π—Ç–∏–Ω–≥</th>
                        <th rowspan="2">–†–∞–∑–º–µ—Ä –∫—É–ø–æ–Ω–∞</th>
                        <th rowspan="2">–ü–µ—Ä–∏–æ–¥</th>
                        <th rowspan="2">–ü–æ–≥–∞—à–µ–Ω–∏–µ</th>
                        <th colspan="4" class="group-header costs-group">üí∞ –ó–∞—Ç—Ä–∞—Ç—ã</th>
                        <th colspan="3" class="group-header income-group">üìà –î–æ—Ö–æ–¥—ã</th>
                        <th rowspan="2" class="group-header results-group">üíé –ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å</th>
                        <th rowspan="2" class="group-header results-group">üéØ –ì–æ–¥–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å</th>
                    </tr>
                    <tr>
                        <th class="costs-group">–¶–µ–Ω–∞</th>
                        <th class="costs-group">–ù–ö–î</th>
                        <th class="costs-group">–ö–æ–º–∏—Å—Å–∏—è</th>
                        <th class="costs-group">–ò—Ç–æ–≥–æ –∑–∞—Ç—Ä–∞—Ç—ã</th>
                        <th class="income-group">–ù–æ–º–∏–Ω–∞–ª</th>
                        <th class="income-group">–ö—É–ø–æ–Ω</th>
                        <th class="income-group">–ò—Ç–æ–≥–æ –¥–æ—Ö–æ–¥</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="bond : ${bonds}">
                        <td class="ticker" th:text="${bond.ticker}">BOND</td>
                        <td class="short-name" th:text="${bond.shortName}" th:title="${bond.shortName}">–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±–ª–∏–≥–∞—Ü–∏–∏</td>
                        <td class="rating" th:text="${bond.ratingValue != null ? bond.ratingValue : '-'}" 
                            th:title="${bond.ratingValue != null ? '–ö—Ä–µ–¥–∏—Ç–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥: ' + bond.ratingValue : '–†–µ–π—Ç–∏–Ω–≥ –Ω–µ –ø—Ä–∏—Å–≤–æ–µ–Ω'}"
                            th:style="${bond.ratingValue != null ? 
                                (bond.ratingValue.startsWith('ruAAA') or bond.ratingValue.startsWith('ruAA') ? 'color: #2e7d32; background-color: #e8f5e8;' :
                                 bond.ratingValue.startsWith('ruA') ? 'color: #388e3c; background-color: #f1f8e9;' :
                                 bond.ratingValue.startsWith('ruBBB') ? 'color: #f57c00; background-color: #fff3e0;' :
                                 bond.ratingValue.startsWith('ruBB') or bond.ratingValue.startsWith('ruB') ? 'color: #d32f2f; background-color: #ffebee;' :
                                 'color: #424242; background-color: #f5f5f5;') : 
                                'color: #999; font-style: italic;'}">-</td>
                        <td class="currency" th:text="${bond.couponValue != null ? #numbers.formatDecimal(bond.couponValue, 0, 2) : '0.00'}">0.00</td>
                        <td th:text="${bond.couponLength != null ? bond.couponLength + ' –¥–Ω.' : '-'}" style="text-align: center; color: #666;">365 –¥–Ω.</td>
                        <td class="date" th:text="${bond.maturityDate != null ? #temporals.format(bond.maturityDate, 'dd.MM.yyyy') : '-'}">01.01.2025</td>
                        
                        <!-- –ë–ª–æ–∫ –∑–∞—Ç—Ä–∞—Ç -->
                        <td class="currency costs-group" th:text="${bond.price != null ? #numbers.formatDecimal(bond.price, 0, 2) : '0.00'}">0.00</td>
                        <td class="currency costs-group" th:text="${bond.nkd != null ? #numbers.formatDecimal(bond.nkd, 0, 2) : '0.00'}">0.00</td>
                        <td class="currency costs-group" th:text="${bond.fee != null ? #numbers.formatDecimal(bond.fee, 0, 2) : '0.00'}">0.00</td>
                        <td class="currency costs-group" th:text="${bond.costs != null ? #numbers.formatDecimal(bond.costs, 0, 2) : '0.00'}" style="font-weight: bold;">0.00</td>
                        
                        <!-- –ë–ª–æ–∫ –¥–æ—Ö–æ–¥–æ–≤ -->
                        <td class="currency income-group" th:text="${bond.faceValue != null ? #numbers.formatDecimal(bond.faceValue, 0, 2) : '0.00'}">0.00</td>
                        <td class="currency income-group" th:text="${bond.couponRedemption != null ? #numbers.formatDecimal(bond.couponRedemption, 0, 2) : '0.00'}">0.00</td>
                        <td class="currency income-group" th:text="${bond.profit != null ? #numbers.formatDecimal(bond.profit, 0, 2) : '0.00'}" style="font-weight: bold;">0.00</td>
                        
                        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
                        <td class="currency results-group" th:text="${bond.profitNet != null ? #numbers.formatDecimal(bond.profitNet, 0, 2) : '0.00'}"
                            th:style="'font-weight: bold; color: ' + (${bond.profitNet != null and bond.profitNet.compareTo(T(java.math.BigDecimal).ZERO) >= 0} ? '#4caf50' : '#f44336')">0.00</td>
                        
                        <!-- –ì–æ–¥–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–ª—é—á–µ–≤–æ–π —Å—Ç–∞–≤–∫–∏ 18% -->
                        <td class="yield-cell results-group" 
                            th:text="${bond.annualYield != null ? #numbers.formatDecimal(bond.annualYield, 0, 2) + '%' : '0.00%'}"
                            th:style="'background-color: ' + ${T(ru.misterparser.bonds.util.ColorUtils).getYieldColor(bond.annualYield)} + '; color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.7);'"
                            th:title="${bond.annualYield != null ? '–î–æ—Ö–æ–¥–Ω–æ—Å—Ç—å: ' + #numbers.formatDecimal(bond.annualYield, 0, 2) + '% (–∫–ª—é—á–µ–≤–∞—è —Å—Ç–∞–≤–∫–∞ 18%)' : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏'}">
                            0.00%
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="legend">
            <div class="legend-title">üìä –ì—Ä–∞–¥–∏–µ–Ω—Ç –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–ª—é—á–µ–≤–æ–π —Å—Ç–∞–≤–∫–∏ 18%</div>
            <div class="legend-items">
                <div class="legend-item">
                    <span class="legend-color" style="background-color: #009900;"></span>
                    <span class="legend-text">< 18%</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color" style="background-color: #00cc00;"></span>
                    <span class="legend-text">‚âà 18% (–∫–ª—é—á–µ–≤–∞—è —Å—Ç–∞–≤–∫–∞)</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color" style="background-color: #cccc00;"></span>
                    <span class="legend-text">18-24% (–∂–µ–ª—Ç—ã–π)</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color" style="background-color: #ff6600;"></span>
                    <span class="legend-text">24-30% (–æ—Ä–∞–Ω–∂–µ–≤—ã–π)</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color" style="background-color: #ff0000;"></span>
                    <span class="legend-text">30-36% (–∫—Ä–∞—Å–Ω—ã–π)</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color" style="background-color: #800020;"></span>
                    <span class="legend-text">> 36% (–±–æ—Ä–¥–æ–≤—ã–π)</span>
                </div>
            </div>
            
            <div class="legend-title" style="margin-top: 15px;">‚≠ê –¶–≤–µ—Ç–æ–≤–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤</div>
            <div class="legend-items">
                <div class="legend-item">
                    <span class="legend-color" style="background-color: #e8f5e8; border: 1px solid #2e7d32;"></span>
                    <span class="legend-text">ruAAA, ruAA (–≤—ã—Å—à–∏–π)</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color" style="background-color: #f1f8e9; border: 1px solid #388e3c;"></span>
                    <span class="legend-text">ruA (–≤—ã—Å–æ–∫–∏–π)</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color" style="background-color: #fff3e0; border: 1px solid #f57c00;"></span>
                    <span class="legend-text">ruBBB (—Å—Ä–µ–¥–Ω–∏–π)</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color" style="background-color: #ffebee; border: 1px solid #d32f2f;"></span>
                    <span class="legend-text">ruBB, ruB (—Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω—ã–π)</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color" style="background-color: #f5f5f5; border: 1px solid #999;"></span>
                    <span class="legend-text">–†–µ–π—Ç–∏–Ω–≥ –Ω–µ –ø—Ä–∏—Å–≤–æ–µ–Ω</span>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <form method="get" style="display: inline;">
                <div class="form-group">
                    <label for="limit">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±–ª–∏–≥–∞—Ü–∏–π:</label>
                    <input type="number" id="limit" name="limit" th:value="${limit}" min="10" max="500" step="10">
                </div>
                <div class="form-group">
                    <label for="weeksToMaturity">–ù–µ–¥–µ–ª—å –¥–æ –ø–æ–≥–∞—à–µ–Ω–∏—è:</label>
                    <input type="number" id="weeksToMaturity" name="weeksToMaturity" th:value="${weeksToMaturity}" min="1" max="520" step="1" placeholder="–ù–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ">
                </div>
                <button type="submit">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
            </form>
            
            <div style="float: right;">
                <a href="/api/bonds" style="text-decoration: none;">
                    <button type="button">üìä API –¥–∞–Ω–Ω—ã–µ</button>
                </a>
                <button type="button" onclick="window.location.reload()">‚ôªÔ∏è –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</button>
            </div>
        </div>
    </div>
</body>
</html>