<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–æ–ø –æ–±–ª–∏–≥–∞—Ü–∏–π –ø–æ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 2.2em;
            font-weight: 300;
        }

        .info {
            padding: 15px 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-container {
            overflow-x: auto;
            padding: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        th {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            border: 1px solid #dee2e6;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        td {
            padding: 10px 8px;
            text-align: center;
            border: 1px solid #dee2e6;
            white-space: nowrap;
        }

        tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        tr:hover {
            background-color: #e3f2fd;
        }

        .ticker {
            font-weight: bold;
            color: #1976d2;
            min-width: 80px;
        }

        .short-name {
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
            text-align: left;
            padding-left: 12px;
        }

        .group-header {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            font-weight: bold;
            color: #1565c0;
        }

        .costs-group { border-left: 4px solid #ff9800; }
        .income-group { border-left: 4px solid #4caf50; }
        .results-group { border-left: 4px solid #9c27b0; }

        .currency::after {
            content: " ‚ÇΩ";
            color: #666;
        }

        .percentage::after {
            content: "%";
            color: #666;
        }

        .yield-cell {
            font-weight: bold;
            border-radius: 4px;
            padding: 8px !important;
        }

        .controls {
            padding: 15px 20px;
            background: #f8f9fa;
            border-top: 1px solid #dee2e6;
        }

        .form-group {
            display: inline-block;
            margin-right: 20px;
        }

        label {
            font-weight: 600;
            margin-right: 10px;
        }

        input, button {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }

        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .date {
            color: #666;
            font-size: 11px;
        }

        .offer-row {
            background-color: #e8f5e8 !important;
        }

        .offer-row:hover {
            background-color: #d4edda !important;
        }

        .offer-indicator {
            background-color: #28a745;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            margin-left: 5px;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üèÜ –¢–æ–ø –æ–±–ª–∏–≥–∞—Ü–∏–π –ø–æ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏</h1>
    </div>

    <!-- –§–∏–ª—å—Ç—Ä—ã –≤–≤–µ—Ä—Ö—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <div class="controls">
        <form method="get" style="display: inline;">
            <div class="form-group">
                <label for="limit">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∏–∫–µ—Ä–æ–≤:</label>
                <input type="number" id="limit" name="limit" th:value="${limit}" min="10" max="500" step="10">
            </div>
            <div class="form-group">
                <label for="minWeeksToMaturity">–ù–µ–¥–µ–ª—å –¥–æ –ø–æ–≥–∞—à–µ–Ω–∏—è –æ—Ç:</label>
                <input type="number" id="minWeeksToMaturity" name="minWeeksToMaturity" th:value="${minWeeksToMaturity}" min="0" max="520" step="1">
            </div>
            <div class="form-group">
                <label for="maxWeeksToMaturity">–¥–æ:</label>
                <input type="number" id="maxWeeksToMaturity" name="maxWeeksToMaturity" th:value="${maxWeeksToMaturity}" min="0" max="520" step="1">
            </div>
            <div class="form-group">
                <label for="showOffer">
                    <input type="checkbox" id="showOffer" name="showOffer" th:checked="${showOffer}">
                    –ü–æ –æ—Ñ–µ—Ä—Ç–µ, –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ
                </label>
            </div>
            <button type="submit">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
        </form>

        <div style="float: right;">
            <button type="button" onclick="window.location.reload()">‚ôªÔ∏è –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</button>
        </div>
    </div>

    <div class="info">
        <div>
            <strong>–ü–æ–∫–∞–∑–∞–Ω–æ:</strong> <span th:text="${totalBonds}">0</span> –æ–±–ª–∏–≥–∞—Ü–∏–π
            <span th:if="${minWeeksToMaturity != 0 or maxWeeksToMaturity != 26}">
                    (–ø–æ–≥–∞—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ <span th:text="${minWeeksToMaturity}">0</span>-<span th:text="${maxWeeksToMaturity}">26</span> –Ω–µ–¥–µ–ª—å)
                </span>
        </div>
        <div>
            <strong>–û–±–Ω–æ–≤–ª–µ–Ω–æ:</strong> <span th:text="${#temporals.format(#temporals.createNow(), 'dd.MM.yyyy HH:mm')}"></span>
        </div>
    </div>

    <div class="table-container">
        <table>
            <thead>
            <tr>
                <th rowspan="2">–¢–∏–∫–µ—Ä</th>
                <th rowspan="2">–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                <th rowspan="2">–†–µ–π—Ç–∏–Ω–≥</th>
                <th rowspan="2">–†–∞–∑–º–µ—Ä –∫—É–ø–æ–Ω–∞</th>
                <th rowspan="2">–ü–µ—Ä–∏–æ–¥</th>
                <th rowspan="2">–ü–æ–≥–∞—à–µ–Ω–∏–µ</th>
                <th colspan="4" class="group-header costs-group">üí∞ –ó–∞—Ç—Ä–∞—Ç—ã</th>
                <th colspan="3" class="group-header income-group">üìà –î–æ—Ö–æ–¥—ã</th>
                <th rowspan="2" class="group-header results-group">üíé –ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å</th>
                <th rowspan="2" class="group-header results-group">üéØ –ì–æ–¥–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å</th>
            </tr>
            <tr>
                <th class="costs-group">–¶–µ–Ω–∞</th>
                <th class="costs-group">–ù–ö–î</th>
                <th class="costs-group">–ö–æ–º–∏—Å—Å–∏—è</th>
                <th class="costs-group">–ò—Ç–æ–≥–æ –∑–∞—Ç—Ä–∞—Ç—ã</th>
                <th class="income-group">–ù–æ–º–∏–Ω–∞–ª</th>
                <th class="income-group">–ö—É–ø–æ–Ω</th>
                <th class="income-group">–ò—Ç–æ–≥–æ –¥–æ—Ö–æ–¥</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="bond : ${bonds}"
                th:class="${showOffer and bond.offerDate != null and bond.annualYieldOffer != null} ? 'offer-row' : ''">
                <td class="ticker" th:text="${bond.ticker}">BOND</td>
                <td class="short-name" th:title="${bond.shortName}">
                    <span th:text="${bond.shortName}">–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±–ª–∏–≥–∞—Ü–∏–∏</span>
                    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ—Ñ–µ—Ä—Ç—ã -->
                    <span th:if="${showOffer and bond.offerDate != null and bond.annualYieldOffer != null}"
                          class="offer-indicator">–û–§–ï–†–¢–ê</span>
                </td>
                <td class="rating" th:text="${bond.ratingValue != null ? bond.ratingValue : '-'}"
                    th:title="${bond.ratingValue != null ? '–ö—Ä–µ–¥–∏—Ç–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥: ' + bond.ratingValue : '–†–µ–π—Ç–∏–Ω–≥ –Ω–µ –ø—Ä–∏—Å–≤–æ–µ–Ω'}"
                    style="font-weight: bold; text-align: center; min-width: 60px; font-size: 11px;">-</td>
                <td class="currency" th:text="${#numbers.formatDecimal(bond.couponValue, 0, 2)}">0.00</td>
                <td th:text="${bond.couponLength} + ' –¥–Ω.'" style="text-align: center; color: #666;">365 –¥–Ω.</td>

                <!-- –î–∞—Ç–∞ –ø–æ–≥–∞—à–µ–Ω–∏—è –∏–ª–∏ –¥–∞—Ç–∞ –æ—Ñ–µ—Ä—Ç—ã -->
                <td class="date">
                            <span th:if="${showOffer and bond.offerDate != null and bond.annualYieldOffer != null}"
                                  th:text="${#temporals.format(bond.offerDate, 'dd.MM.yyyy')}"
                                  th:title="'–î–∞—Ç–∞ –æ—Ñ–µ—Ä—Ç—ã: ' + ${#temporals.format(bond.offerDate, 'dd.MM.yyyy')}">01.01.2025</span>
                    <span th:unless="${showOffer and bond.offerDate != null and bond.annualYieldOffer != null}"
                          th:text="${#temporals.format(bond.maturityDate, 'dd.MM.yyyy')}"
                          th:title="'–î–∞—Ç–∞ –ø–æ–≥–∞—à–µ–Ω–∏—è: ' + ${#temporals.format(bond.maturityDate, 'dd.MM.yyyy')}">01.01.2025</span>
                </td>

                <!-- –ë–ª–æ–∫ –∑–∞—Ç—Ä–∞—Ç -->
                <td class="currency costs-group" th:text="${#numbers.formatDecimal(bond.price, 0, 2)}">0.00</td>
                <td class="currency costs-group" th:text="${#numbers.formatDecimal(bond.nkd, 0, 2)}">0.00</td>
                <td class="currency costs-group" th:text="${#numbers.formatDecimal(bond.fee, 0, 2)}">0.00</td>
                <td class="currency costs-group" th:text="${#numbers.formatDecimal(bond.costs, 0, 2)}" style="font-weight: bold;">0.00</td>

                <!-- –ë–ª–æ–∫ –¥–æ—Ö–æ–¥–æ–≤ -->
                <td class="currency income-group" th:text="${#numbers.formatDecimal(bond.faceValue, 0, 2)}">0.00</td>

                <!-- –ö—É–ø–æ–Ω: –ø–æ –æ—Ñ–µ—Ä—Ç–µ –∏–ª–∏ –¥–æ –ø–æ–≥–∞—à–µ–Ω–∏—è -->
                <td class="currency income-group">
                            <span th:if="${showOffer and bond.offerDate != null and bond.annualYieldOffer != null and bond.couponOffer != null}"
                                  th:text="${#numbers.formatDecimal(bond.couponOffer, 0, 2)}"
                                  th:title="'–ö—É–ø–æ–Ω–Ω—ã–µ –≤—ã–ø–ª–∞—Ç—ã –¥–æ –¥–∞—Ç—ã –æ—Ñ–µ—Ä—Ç—ã'">0.00</span>
                    <span th:unless="${showOffer and bond.offerDate != null and bond.annualYieldOffer != null and bond.couponOffer != null}"
                          th:text="${#numbers.formatDecimal(bond.couponRedemption, 0, 2)}"
                          th:title="'–ö—É–ø–æ–Ω–Ω—ã–µ –≤—ã–ø–ª–∞—Ç—ã –¥–æ –ø–æ–≥–∞—à–µ–Ω–∏—è'">0.00</span>
                </td>

                <!-- –ò—Ç–æ–≥–æ –¥–æ—Ö–æ–¥: –ø–æ –æ—Ñ–µ—Ä—Ç–µ –∏–ª–∏ –¥–æ –ø–æ–≥–∞—à–µ–Ω–∏—è -->
                <td class="currency income-group" style="font-weight: bold;">
                            <span th:if="${showOffer and bond.offerDate != null and bond.annualYieldOffer != null and bond.profitOffer != null}"
                                  th:text="${#numbers.formatDecimal(bond.profitOffer, 0, 2)}"
                                  th:title="'–û–±—â–∏–π –¥–æ—Ö–æ–¥ –ø—Ä–∏ –¥–æ—Å—Ä–æ—á–Ω–æ–º –ø–æ–≥–∞—à–µ–Ω–∏–∏ –ø–æ –æ—Ñ–µ—Ä—Ç–µ'">0.00</span>
                    <span th:unless="${showOffer and bond.offerDate != null and bond.annualYieldOffer != null and bond.profitOffer != null}"
                          th:text="${#numbers.formatDecimal(bond.profit, 0, 2)}"
                          th:title="'–û–±—â–∏–π –¥–æ—Ö–æ–¥ –ø—Ä–∏ –ø–æ–≥–∞—à–µ–Ω–∏–∏'">0.00</span>
                </td>

                <!-- –ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å: –ø–æ –æ—Ñ–µ—Ä—Ç–µ –∏–ª–∏ –æ–±—ã—á–Ω–∞—è -->
                <td class="currency results-group">
                            <span th:if="${showOffer and bond.offerDate != null and bond.annualYieldOffer != null and bond.profitNetOffer != null}"
                                  th:text="${#numbers.formatDecimal(bond.profitNetOffer, 0, 2)}"
                                  th:style="'font-weight: bold; color: ' + (${bond.profitNetOffer} >= 0 ? '#4caf50' : '#f44336')"
                                  th:title="'–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å –ø–æ—Å–ª–µ –Ω–∞–ª–æ–≥–æ–≤ –ø—Ä–∏ –¥–æ—Å—Ä–æ—á–Ω–æ–º –ø–æ–≥–∞—à–µ–Ω–∏–∏'">0.00</span>
                    <span th:unless="${showOffer and bond.offerDate != null and bond.annualYieldOffer != null and bond.profitNetOffer != null}"
                          th:text="${#numbers.formatDecimal(bond.profitNet, 0, 2)}"
                          th:style="'font-weight: bold; color: ' + (${bond.profitNet} >= 0 ? '#4caf50' : '#f44336')"
                          th:title="'–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å –ø–æ—Å–ª–µ –Ω–∞–ª–æ–≥–æ–≤ –ø—Ä–∏ –ø–æ–≥–∞—à–µ–Ω–∏–∏'">0.00</span>
                </td>

                <!-- –ì–æ–¥–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å: –ø–æ –æ—Ñ–µ—Ä—Ç–µ –∏–ª–∏ –æ–±—ã—á–Ω–∞—è -->
                <td class="yield-cell results-group"
                    th:if="${showOffer and bond.offerDate != null and bond.annualYieldOffer != null}"
                    th:text="${#numbers.formatDecimal(bond.annualYieldOffer, 0, 2)} + '%'"
                    th:style="'background-color: ' + ${T(ru.misterparser.bonds.util.ColorUtils).getYieldColor(bond.annualYieldOffer, minYield, maxYield)} + '; color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.7);'"
                    th:title="'–ì–æ–¥–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –ø—Ä–∏ –¥–æ—Å—Ä–æ—á–Ω–æ–º –ø–æ–≥–∞—à–µ–Ω–∏–∏ –ø–æ –æ—Ñ–µ—Ä—Ç–µ'">0.00%</td>
                <td class="yield-cell results-group"
                    th:unless="${showOffer and bond.offerDate != null and bond.annualYieldOffer != null}"
                    th:text="${#numbers.formatDecimal(bond.annualYield, 0, 2)} + '%'"
                    th:style="'background-color: ' + ${T(ru.misterparser.bonds.util.ColorUtils).getYieldColor(bond.annualYield, minYield, maxYield)} + '; color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.7);'"
                    th:title="'–ì–æ–¥–æ–≤–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å –ø—Ä–∏ –ø–æ–≥–∞—à–µ–Ω–∏–∏'">0.00%</td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="controls">
        <div style="text-align: center;">
            <a href="/api/bonds" style="text-decoration: none;">
                <button type="button">üìä API –¥–∞–Ω–Ω—ã–µ</button>
            </a>
        </div>
    </div>
</div>
</body>
</html>