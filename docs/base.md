# Система мониторинга облигаций

## Описание системы

Система для анализа и мониторинга рынка облигаций, которая собирает данные из различных источников, рассчитывает показатели доходности и предоставляет информацию о наиболее привлекательных инвестиционных возможностях.

## Функциональные модули

### 1. Сбор данных об облигациях
- **[MOEX](moex.md)** - получение базовых данных с Московской биржи
- **[T-Bank Instruments](tbank-instruments.md)** - получение данных об активах и инструментах через API Тинькофф
- **[T-Bank Market Data](tbank-prices.md)** - получение актуальных цен через API Тинькофф

### 2. Сбор рейтинговых данных
- **[RaExpert](raexpert.md)** - парсинг рейтингов облигаций с сайта raexpert.ru
- **[Общие принципы работы с рейтингами](ratings.md)** - архитектура системы рейтингов

### 3. Аналитические функции
- **[Расчет показателей доходности](calc.md)** - вычисление финансовых показателей
- **[Отображение топ-облигаций](top.md)** - веб-интерфейс для просмотра результатов

### 4. Кастомизация
- **[Подписка на информацию об оферте](telegram.md)** - ежедневные уведомления о ближайших офертах

## Архитектура данных

### Основные таблицы
- **bonds** - основная таблица с данными об облигациях
- **instruments** - дополнительные данные от T-Bank API
- **ratings** - история рейтингов облигаций

### Ключевые поля
- **ISIN** - уникальный идентификатор облигации (синоним ticker)
- **FIGI** - идентификатор инструмента для T-Bank API
- **Asset UID** - идентификатор актива в T-Bank

## Технические требования

### Платформа
- **Java 11**
- **Spring Boot 2.7** с модулями: Web, JDBC, Scheduling, Lombok (в том числе для конфигураций)
- **Maven** для сборки проекта
- **PostgreSQL** для хранения данных
- **Liquibase** для управления схемой БД (SQL формат)
- **Docker** для контейнеризации

### Конфигурация
- **Основной пакет**: `ru.misterparser.bonds`
- **Формат cron**: для настройки периодичности задач
- **Уровень логирования**: INFO по умолчанию
- **Кодировка**: UTF-8 (CP1251 для MOEX CSV)

### Паттерны и принципы
- **Rate Limiting**: 60 запросов в минуту для внешних API
- **Caching**: локальное кэширование для снижения нагрузки
- **Error Handling**: логирование ошибок с продолжением работы
- **Graceful Degradation**: fallback-механизмы для каждого источника данных
- **Транзакционность**: все методы сервисного слоя должны быть помечены @Transactional. 
  Каждая обработка облигации, её данных, рейтинга, цен, показателей должна быть в своей транзакции, чтобы они сохранялись в БД последовательно, а не одной пачкой.
- **Dependency Injection**: через final, конструкторы и Lombok
- **Логгеры**: должны быть подключены через Lombok

## Архитектура компонентов

```
Data Sources → Services → Repositories → Database → Web Interface
     ↓            ↓           ↓           ↓            ↓
   MOEX       MoexService   BondRepo    bonds      WebController
   T-Bank     TBankService  InstrRepo   instruments   /top.html
   RaExpert   RatingService RatingRepo  ratings
```

## Мониторинг и эксплуатация

### Планировщики задач
Все задачи настраиваются через cron-выражения в конфигурации:
- Обновление данных с внешних источников
- Расчет показателей доходности
- Очистка кэша и служебные задачи
- Конфигурация SchedulingConfig устанавливает пул из 10 потоков для выполнения @Scheduled задач, что обеспечивает параллельное выполнение нескольких задач по расписанию
- Потоки именуются с префиксом scheduled-task-

### Часовой пояс
Приложение использует московское время (GMT+3, Europe/Moscow):
- **Docker контейнер**: системный часовой пояс установлен в Dockerfile через `tzdata` и `TZ=Europe/Moscow`
- **Cron-задачи**: выполняются по московскому времени
- **Системное время**: контейнер работает в часовом поясе Europe/Moscow независимо от хост-системы