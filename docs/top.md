# Отображение списка наиболее доходных облигаций

## Основные функции 

Представляет собой html-страницу по адресу top.html, которая выводит список наиболее доходных облигаций с интерактивными фильтрами и автоматическим поиском.

## Технические требования

### Базовая функциональность
- Страница соответствует шаблону top-bonds.html
- Использование шаблонизатора Thymeleaf
- В таблице выводятся только облигации с доходностью не выше 50%
- После названия облигации отображается рейтинг

### Визуализация и стилизация
- Колонка "Годовая доходность" раскрашивается градиентом относительно ключевой ставки 18%:
  - На уровне 18% - зеленый цвет
  - Выше 18% - постепенный переход: желтый → красный → бордовый
  - При двукратном превышении (36%+) - бордовый цвет
- Колонка Рейтинг также раскрашивается градиентом от красного (самые рискованные облигации) до зелёного (самые надёжные).
  Возможные значения рейтинга указаны в ratings.md, а их раскраска в файле rating-gradient.js
  Строки без рейтинга должны быть с серым градиентом в колонке Рейтинг
- Строки с информацией по оферте выделяются зеленым цветом (кроме столбца с градиентом)
- Индикатор "ОФЕРТА" для соответствующих строк

### Фильтрация и поиск
- Все фильтры размещены в одну строку вверху страницы
- **Количество тикеров**: числовое поле для лимита результатов (по умолчанию 50)
- **Диапазон недель до погашения**:
  - одно текстовое поле, которое может принимать:
    - либо два дробных числа ("от" и "до") через дефис (по умолчанию 0-26),
    - либо одно дробное число и тогда начальная граница считается равной 0.
- **Поиск по тикеру/названию**: 
  - Автоматический поиск при вводе 3+ символов
  - Debounce задержка 500мс для оптимизации
  - Индикатор загрузки во время поиска
  - Сохранение позиции курсора при обновлении
- **Чекбокс "Оферта"**:
  - Мгновенное обновление таблицы при переключении
  - Показывает данные по оферте вместо погашения
- **Поле ввода процента комиссии**:
  - Необходимо пересчитывать комиссию для каждого конкретного запроса рейтинга
  - Она должна влиять на комиссию и итоговые затраты, прибыль, чистую прибыль и годовую доходность, отображаемые в таблице
  - Для этого нужно использовать методы из сервиса calc, в которых уже есть алгоритмы учёта комиссии
  - Для строк с офертой комиссия должна учитываться в двойном размере и в столбце Комиссия должна быть иконка с подсказкой, объясняющей, что оферта здесь дважды
  - **Важно:** в столбце "Комиссия" отображается именно та сумма комиссии, которая была использована в расчётах (однократная для погашения, двойная для оферты)
- **Фильтр по диапазону максимальной доходности**:
  - одно текстовое поле, которое может принимать:
    - либо два дробных числа ("от" и "до") через дефис (по умолчанию 0-50),
    - либо одно дробное число и тогда начальная граница считается равной 0.
  - ограничения на максимальные значения нет
  - разница между максимальной и минимальной доходностями должна быть больше 0
- **Фильтр по рейтингу**:
  - Можно выбрать несколько вариантов флажками
- Все значения фильтров должны быть привязаны к аккаунту пользователя и при отображении страницы заполняться.

### Режим оферты
При включении опции "Оферта":
- В колонках "Доходы" отображаются показатели доходности по оферте
- В колонке "Чистая прибыль" показывается прибыль по оферте
- В колонке "Погашение" указывается дата оферты вместо даты погашения
- Строки с офертными данными выделяются зеленым фоном
- Фильтрация по доходности происходит на backend независимо от типа (к погашению или к оферте)

### Сортировка
- Первичная сортировка: по FLOOR(доходность) в убывающем порядке
- Вторичная сортировка: по rating_code в возрастающем порядке (надежные компании выше)
- Третичная сортировка: по точной доходности в убывающем порядке

### Интерактивность
- Автоматическая отправка формы при изменении чекбокса оферты
- Сохранение фокуса и позиции курсора в поле поиска
- Debounce для поискового запроса (500мс)
- Единственная кнопка "Обновить" для ручного применения фильтров

### Адаптивность
- Контейнер шириной до 1600px для размещения всех фильтров в одну строку
- Компактные размеры полей ввода для оптимального использования пространства
- Responsive дизайн с возможностью переноса фильтров на маленьких экранах

### Техническая реализация
- Шаблон страница должен получать DTO только с полями, необходимыми для таблицы рейтинга

## Описание колонок таблицы

Таблица имеет двухуровневую структуру заголовков с группировкой колонок по функциональному назначению.

### Основная информация (без группировки)

| Колонка           | Поле модели                | Описание                       | Особенности                                                                                                     |
|-------------------|----------------------------|--------------------------------|-----------------------------------------------------------------------------------------------------------------|
| **Тикер**         | `ticker`                   | Торговый тикер облигации       | Жирный шрифт, синий цвет, минимальная ширина 80px                                                               |
| **Название**      | `shortName`                | Краткое наименование облигации | Максимальная ширина 150px, обрезка с многоточием, выравнивание слева, индикатор "ОФЕРТА" для офертных облигаций |
| **Рейтинг**       | `ratingValue`              | Кредитный рейтинг              | Цветовой градиент от красного до зеленого, белый текст с тенью, жирный шрифт, размер 11px                       |
| **Размер купона** | `couponValue`              | Размер купонного дохода        | Формат с валютным символом ₽                                                                                    |
| **Период**        | `couponLength`             | Длительность купонного периода | Формат "N дн.", серый цвет                                                                                      |
| **Погашение**     | `maturityDate`/`offerDate` | Дата погашения или оферты      | Формат DD.MM.YYYY, серый цвет, размер 11px, переключается в зависимости от режима оферты                        |

Тикер должен быть ссылкой по шаблону: https://yandex.ru/search/?text=${ticker}

### Группа "💰 Затраты" (costs-group, оранжевая граница)

| Колонка           | Поле модели | Описание                        | Особенности                                                                       |
|-------------------|-------------|---------------------------------|-----------------------------------------------------------------------------------|
| **Цена**          | `price`     | Текущая рыночная цена облигации | Формат с валютным символом ₽, иконка подсказки с датой и временем обновления цены |
| **НКД**           | `nkd`       | Накопленный купонный доход      | Формат с валютным символом ₽                                                      |
| **Комиссия**      | `fee`       | Брокерская комиссия             | Формат с валютным символом ₽, иконка подсказки для оферт (двойная комиссия)       |
| **Итого затраты** | `costs`     | Общие затраты на покупку        | Формат с валютным символом ₽, жирный шрифт                                        |

### Группа "📈 Доходы" (income-group, зеленая граница)

| Колонка         | Поле модели                      | Описание                        | Особенности                                                              |
|-----------------|----------------------------------|---------------------------------|--------------------------------------------------------------------------|
| **Номинал**     | `faceValue`                      | Номинальная стоимость облигации | Формат с валютным символом ₽                                             |
| **Купон**       | `couponRedemption`/`couponOffer` | Купонные выплаты                | Формат с валютным символом ₽, переключается между режимами               |
| **Итого доход** | `profit`/`profitOffer`           | Общий валовый доход             | Формат с валютным символом ₽, жирный шрифт, переключается между режимами |

### Группа "Результаты" (results-group, фиолетовая граница)

| Колонка                   | Поле модели                      | Описание                       | Особенности                                                                                                    |
|---------------------------|----------------------------------|--------------------------------|----------------------------------------------------------------------------------------------------------------|
| **💎 Чистая прибыль**     | `profitNet`/`profitNetOffer`     | Прибыль после налогов          | Формат с валютным символом ₽, жирный шрифт, зеленый цвет для положительных значений, красный для отрицательных |
| **🎯 Годовая доходность** | `annualYield`/`annualYieldOffer` | Годовая доходность в процентах | Цветовой градиент относительно 18%, белый текст с тенью, формат с символом %, класс yield-cell                 |

### Особенности отображения

**Цветовая индикация строк:**
- **Обычные строки**: чередующийся фон (#f8f9fa для четных строк)
- **Строки с офертой**: зеленый фон (#e8f5e8), при наведении #d4edda
- **При наведении**: голубой фон (#e3f2fd)

**Режим оферты:**
- Переключается чекбоксом "Оферта" в фильтрах
- Отображает данные с суффиксом `Offer` вместо обычных полей
- Показывает дату оферты вместо даты погашения
- Добавляет индикатор "ОФЕРТА" в колонку "Название"
- Удваивает комиссию и показывает подсказку с иконкой

**Группировка колонок:**
- **Затраты**: оранжевая левая граница (border-left: 4px solid #ff9800)
- **Доходы**: зеленая левая граница (border-left: 4px solid #4caf50)
- **Результаты**: фиолетовая левая граница (border-left: 4px solid #9c27b0)

**Форматирование:**
- Денежные значения: автоматический символ ₽ через CSS ::after
- Проценты: автоматический символ % через CSS ::after
- Числа: форматирование через Thymeleaf с 2 знаками после запятой
